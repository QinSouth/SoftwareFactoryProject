<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="js/resources/css/ext-all.css" />
		<script type="text/javascript" src="js/ext-all.js"></script>
		<script type="text/javascript" src="js/locale/ext-lang-zh_CN.js"></script>
		<script type="text/javascript">
			// 创建动态Tree 的数据集 Store
			var dataTreeStore = Ext.create('Ext.data.TreeStore', {
				autoLoad: true, // 是否自动加载
				root: {
					id: "0",
					text: "导航菜单",
					expanded: true
				},
				// 设置 AJAX 
				proxy: {
					type: 'ajax',
					url: '<%=basePath %>tree!GetTreeDate', // Action 请求
					reader: {
						type: 'json',
						root: 'rows' // 返回的JSON的头
					},
					// 传参
					extraParams: {
						tid: ''
					}
				},
				listeners: { // 开启监听事件
					'beforeexpand': function(node, eOpts) {
						//点击父亲节点的菜单会将节点的id通过ajax请求，将到后台  
						//	console.info(node);
						this.proxy.extraParams.tid = node.raw.id;
					}
				}
			});
		
			//左边功能树   
			var menuTree = new Ext.tree.Panel({
				region: 'west',
				title: '功能菜单',
				width: 180,
				minSize: 150,
				maxSize: 200,
				split: true,
				autoScroll: true,
				autoHeight: false,
				collapsible: true,
				rootVisable: true, //不显示根节点   
				store: dataTreeStore,
				listeners: {
					itemclick: function(view, record, item, index, e, eOpts) {
						e.stopEvent();
						var newtab = contentPanel.getComponent(record.get('id'));
						console.info(record);
						if(!newtab && record.get('leaf')) { //判断是否已经打开该面板   
							newtab = contentPanel.add({
								'id': record.get('id'),
								'title': record.get('text'),
								closable: true, //通过html载入目标页   
								html: '<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src="<%=basePath %>' + record.raw.url + '"></iframe>'
							});
		
						};
						contentPanel.setActiveTab(newtab);
					}
				}
			});
		
			/*
			//添加第一个节点(html)   
			menuTree.root.appendChild(new  Ext.tree.TreeNode({  
			  id:'htmlPanel' ,  
			  text:'通过html打开' ,  
			  listeners:{  
			      'click' : function (node, event) {  
			          event.stopEvent();  
			          var  n = contentPanel.getComponent(node.id);  
			          if  (!n) {  //判断是否已经打开该面板   
			              n = contentPanel.add({  
			                  'id' :node.id,  
			                  'title' :node.text,  
			                  closable:true ,   //通过html载入目标页   
			                  html:'<iframe scrolling="auto" frameborder="0" width="100%" height="100%" src="iframe.html"></iframe>'   
			              });  
			          }  
			          contentPanel.setActiveTab(n);  
			      }  
			  }  
			}));  
		
			//添加第二个节点(autoLoad)   
			menuTree.root.appendChild(new  Ext.tree.TreeNode({  
			  id:'autoLoadPanel' ,  
			  text:'通过autoLoad打开' ,  
			  listeners:{  
			      'click' : function (node, event) {  
			          event.stopEvent();  
			          var  n = contentPanel.getComponent(node.id);  
			          if  (!n) {  ////判断是否已经打开该面板   
			              n = contentPanel.add({  
			                  'id' :node.id,  
			                  'title' :node.text,  
			                  closable:true ,  
			                  autoLoad:{url:'auto.php' , scripts: true }  //通过autoLoad属性载入目标页,如果要用到脚本,必须加上scripts属性   
			              });  
			          }  
			          contentPanel.setActiveTab(n);  
			      }  
			  }  
			}));  
		
			//添加第三个节点(function)   
			menuTree.root.appendChild(new  Ext.tree.TreeNode({  
			  id:'functionPanel' ,  
			  text:'通过函数打开' ,  
			  listeners:{  
			      'click' : function (node, event) {  
			          event.stopEvent();  
			          var  n = contentPanel.getComponent(node.id);  
			          if  (!n) {  
			              var  p =  new  fnPanel();  
			              p.id = node.id;  
			              p.title = node.text;  
			              n = contentPanel.add(p);  
			          }  
			          contentPanel.setActiveTab(n);  
			      }  
			  }  
			}));  
		
			*/
			//通过扩展来构建要创建的面板   
			fnPanel = Ext.extend(Ext.Panel, {
				closable: true,
				autoScroll: true,
				layout: 'fit', //如果用函数来创建该面板的话,布局必须设置为fit,否则不会显示该面板中的内容   
		
				//创建面板内容   
				createFormPanel: function() {
					return new Ext.form.FormPanel({
						buttonAlign: 'center',
						labelAlign: 'right',
						frame: false,
						bodyBorder: false,
						bodyStyle: 'padding:25px',
						items: [{
							xtype: 'textfield',
							fieldLabel: '用户名',
							width: 350,
							name: 'username'
						}, {
							xtype: 'textfield',
							fieldLabel: '密　码',
							width: 350,
							name: 'password'
						}],
						buttons: [{
							text: '登陆'
						}, {
							text: '取消'
						}]
					});
				},
		
				//重装控件初始化函数,在该函数中完成面板中内容的初始化   
				initComponent: function() {
					fnPanel.superclass.initComponent.call(this);
					this.fp = this.createFormPanel();
					this.add(this.fp);
				}
			});
		
			//中间具体功能面板区   
			var contentPanel = new Ext.TabPanel({
				region: 'center',
				enableTabScroll: true,
				activeTab: 0,
				frame: true,
				items: [
					{
						id: 'homePage',
						title: '首页1',
						autoScroll: true,
						html: '<div style="position:absolute;color:#ff0000;top:40%;left:40%;">说明文档1</div>'
					}
				]
			});
		
			// 设置顶部面板
			var north = new Ext.Panel({
				frame: true,
				plain: true,
				height: 50,
				region: 'north',
				items: [{
					baseCls: "x-plain",
					border: false,
					height: 29,
					html: "<font style='font-size:24px'>中国航空结算系统</font>"
				}]
			});
		
			Ext.onReady(function() {
				new Ext.Viewport({
					layout: 'border', //使用border布局   
					defaults: {
						activeItem: 0
					},
					items: [menuTree, contentPanel, north]
				});
			});
		</script>
	</head>
	<body>
	</body>
</html>
