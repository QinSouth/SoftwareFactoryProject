<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>销售出库单</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../css/font.css">
		<link rel="stylesheet" href="../../css/xadmin.css">
		
		<script src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/xadmin.js"></script>
	</head>
	<script type="text/javascript" src="../../layui.all.js"></script>

	<link rel="stylesheet" href="../../css/layui.css" />
	<script type="text/javascript" src="../../js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="../../layui.js" ></script>
	<style>
		.xscz {
			margin-left: 35px;
			width: 150px;
		}
	</style>
	<script type="text/javascript">
		window.onload = function() {
			//去掉默认的contextmenu事件，否则会和右键事件同时出现。
			document.oncontextmenu = function(e) {
				e.preventDefault();
			};
			document.getElementById("xsth").onmousedown = function(e) {
				if(e.button == 2) {
					layui.use('layer', function() {
						var layer = layui.layer;
						layer.open({
							title: '请选择操作',
							type: 0,
							content: '<select class=xscz onblur=xsxzcz(this)><option value=1>新增</option><option value=2>修改</option><option value=3>删除</option><option value=4>审核</option></select>'

						});
					});
				}
			}
		}

		function xsxzcz(obj) {
			//alert($(obj).val());
			if($(obj).val() == 1) {
				$("input").prop("readonly", false);
				$("select").prop("disabled", false);
				$("textarea").prop("readonly", false);
			}
			layer.closeAll();
		}
	</script>

	<body>
		<div class="x-body">
			<h2>销售出库单</h2>
		</div>

		<div class="layui-container">
			<div id="xsth">
				<div class="layui-col-md10 layui-col-md-offset2"></div>
				<div class="layui-row">
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">客户</span>
						<input type="text" class="layui-col-md-offset1 layui-input" style="width: 170px;" readonly="readonly" />
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">单据日期</span> <input type="date" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">送货地址</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">单据号码</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">销售出库类型</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">币别</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">单价是否含税</span>
						<select name="" style="width: 170px;" class=" layui-col-md-offset1 layui-input" disabled="disabled">
							<option value=""></option>
						</select>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">汇率</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">仓库</span>
						<select name="" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled">
							<option value=""></option>
						</select>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">国外贸易</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">凭证编码</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div>
					<!--<div class="layui-col-md5">
					<input type="checkbox"  class="layui-col-md1"  disabled="disabled"/> <span class="layui-col-md5" >复核后自动生成发票</span> 
				</div><br /><br />-->
					<div class="layui-tab layui-col-md10 layui-col-md-offset2">
						<ul class="layui-tab-title layui-col-md10 layui-col-md-offset2">
							<li class="layui-this">内容</li>
							<li>备注</li>

						</ul>
						<div class="layui-tab-content layui-col-md10 layui-col-md-offset2">
							<div class="layui-tab-item layui-show layui-tab-content " style=" overflow-x: scroll; overflow-y: scroll;">
								<table class="layui-table" readonly="readonly" height="500">

									<thead>
										<tr>
											<th style="white-space: nowrap;">(栏号)</th>
											<th style="white-space: nowrap;">物料编号</th>
											<th style="white-space: nowrap;">(物料名称)</th>
											<th style="white-space: nowrap;">(规格型号)</th>
											<th style="white-space: nowrap;">(单位名称)</th>
											<th style="white-space: nowrap;">数量</th>
											<th style="white-space: nowrap;">折扣钱单价</th>
											<th style="white-space: nowrap;">折数(%)</th>
											<th style="white-space: nowrap;">单价</th>
											<th style="white-space: nowrap;">金额</th>
											<th style="white-space: nowrap;">税额(%)</th>
											<th style="white-space: nowrap;">(含税金额)</th>
											<th style="white-space: nowrap;">(批号)</th>
											<th style="white-space: nowrap;">赠品</th>
											<th style="white-space: nowrap;">(发票明细)</th>
											<th style="white-space: nowrap;">(未开票金额)</th>
											<th style="white-space: nowrap;">分录备注</th>
											<th style="white-space: nowrap;">(来源单别)</th>
											<th style="white-space: nowrap;">(来源单号)</th>
										</tr>
									</thead>
									<tbody>

									</tbody>
								</table>
							</div>

							<div class="layui-tab-item layui-col-md12">
								<div class="layui-col-md12">
									<span class="layui-col-md2" style="margin-left: 25px;">备注</span><textarea style="margin-left: 27px;" readonly="readonly" rows="6" cols="81"></textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">业务人员</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">制单人员</span><input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">所属部门</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">复核人员</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div><br/><br/>
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">所属项目</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" readonly="readonly" />
					</div>
					<div class="layui-col-md12">
						<button style="width: 150;background: #1E9FFF;" class="layui-col-md2 layui-col-md-offset2 layui-btn" disabled="disabled">转单</button>
						<button style="width: 150;background: #1E9FFF;" class="layui-col-md2 layui-col-md-offset1 layui-btn" disabled="disabled">查询</button>
						<button style="width: 150;background: #1E9FFF;" class="layui-col-md2 layui-col-md-offset1 layui-btn" disabled="disabled">功能</button>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript" src="../../layui.all.js"></script>
		<script src="../../layui.js"></script>

		<!--<script>
    	function oninit(){
    		layui.use('layer',function(){
    			var layer= layui.layer;
    		 layer.open({
    		 	title:'销售出库单',
			  type: 2, 
			  maxmin:true,
			  area:['995px','90%'],
//			  maxWidth:860,
//			  maxHeight:1000,
			  content: '销售出货.html' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
			}); 
    		})
    		
    	}
       
    </script>-->
    <script>
     	var f=0
	 	var flag=false
		var obj={}
		jz(1,1)
		function jz(pageNum,pageSize){
			$.ajax({
				url:"//localhost:8080/SoftwareFactoryProject_/zp/querychuku",
				data:{
					pageNum:pageNum,
              		pageSize:pageSize
				},
				dataType: "json",
				success:function(r){ 
					console.log(r)
					obj=r
					$(r.list).each(function(i,obj){
						$("#customerName").val(obj.customerName)
						$("#sqDocumentTime").val(obj.sqDocumentTime)
						$("#sqDeliveryAddress").val(obj.sqDeliveryAddress)
						$("#sqId").val(obj.sqId)
						$("#sqEffectiveTime").val(obj.sqEffectiveTime)
						$("#currencyName").val(obj.currencyName)
						if(obj.sqTax>0){
							$("#sqTax1").attr("selected","selected")
						}else{
							$("#sqTax2").attr("selected","selected")
						}
						$("#sqExchangeRate").val(obj.sqExchangeRate)
						$("#staffName").val(obj.staffName)
						$("#sqAuditing").val(obj.sqAuditing)
						$("#departName").val(obj.departName)
						$("#sqYn").val(obj.sqYn)
						$("#sqRemark").val(obj.sqRemark)
						$("tbody").html("")
						$(obj.list).each(function(i2,obj2){
							$("tbody").append(""+
								"<tr>"+
								"<td><input name='readonly' id='sqdProdid' value='"+obj2.sqdProdid+"'></td>"+
								"<td><input id='sqdSerno' value='"+obj2.sqdSerno+"'></td>"+
								"<td><input id='sqdProdname' value='"+obj2.sqdProdname+"'></td>"+
								"<td><input id='sqdProdsize' value='"+obj2.sqdProdsize+"'></td>"+
								"<td><input id='sqdUnitname' value='"+obj2.sqdUnitname+"'></td>"+
								"<td><input id='sqdSquantity' value='"+obj2.sqdSquantity+"'></td>"+
								"<td><input id='sqdZkqprice' value='"+obj2.sqdZkqprice+"'></td>"+
								"<td><input id='sqdDiscount' value='"+obj2.sqdDiscount+"'></td>"+
								"<td><input id='sqdUnitprice' value='"+obj2.sqdUnitprice+"'></td>"+
								"<td><input id='sqdPrice' value='"+obj2.sqdPrice+"'></td>"+
								"<td><input id='sqdTaxrate' value='"+obj2.sqdTaxrate+"'></td>"+
								"<td><input id='sqdTaxlimit' value='"+obj2.sqdTaxlimit+"'></td>"+
								"<td><input id='sqdTaxinclusiveprice' value='"+obj2.sqdTaxinclusiveprice+"'></td>"+
								"<td><input id='sqdComplimentart' value='"+obj2.sqdComplimentart+"'></td>"+
								"<td><input id='sqdItemremark' value='"+obj2.sqdItemremark+"'></td>"+
								"</tr>")
						})
					})
					$("table tbody tr td input").attr("readonly","readonly");
				}
			});
		}
		
		
		var state = "";
		
		function subpageTriggerEvent(incident){
			//alert("部门设定页 - 触发事件：" + incident);
			
			if(incident == "goFirstPage"){
				//第一笔
				first()
			} else if(incident == "goPrePage"){
				//上一笔
				left()
			} else if(incident == "goNextPage"){
				//下一笔
				right()
			} else if(incident == "goLastPage"){
				//后一笔
				last()
			} else if(incident == "goInsert"){
				//新增
				toinsert()
			} else if(incident == "save"){
				//保存
				baoc()
			} else if(incident == "cancel"){
				//放弃
			} else if(incident == "goUpdate"){
				//修改
				toupdate()
			} else if(incident == "delete"){
				//删除
				todelete()
			} else if(incident == "refresh"){
				//刷新
				jz(1,1)
			}
			
			state = incident;
		}
		function first(){
			if(obj.pageNum-1==0){
				alert("已经是首页了！")
			}else{
				jz(1,1);
			}
		}
		function left(){
			if(obj.pageNum-1==0){
				alert("这是第一页！")
			}else{
				jz(obj.pageNum-1,1);
			}
		}
		function right(){
			if(obj.pageNum+1<=obj.pages){
				jz(obj.pageNum+1,1)
			}else{
				alert("这是最后一页！")
			}
		}
		function last(){
			if(obj.pageNum+1<=obj.pages){
				jz(obj.pages,1)
			}else{
				alert("已经是尾页了！")
			}
		}
		function toinsert(){
			f=1
			$("[readonly='readonly']").each(function(i,obj){
				$(obj).removeAttr("readonly")
			})
			$("#sqTax").removeAttr("disabled")
			flag=true
			$("#customerName").val("")
			$("#sqDocumentTime").val("")
			$("#sqDeliveryAddress").val("")
			$("#sqId").val("")
			$("#sqEffectiveTime").val("")
			$("#currencyName").val("")
			$("#sqTax").val("")
			$("#sqExchangeRate").val("")
			$("#staffName").val("")
			$("#sqAuditing").val("")
			$("#departName").val("")
			$("#sqYn").val("")
			$("tbody").html("")
			a()
			//定位当前时间
			layui.use('laydate',function(){
				var laydate=layui.laydate;
				laydate.render({
					elem:'#sqDocumentTime',
					value:new Date(),
					done:function(value,date){}
				})
			})
			//自动编写单据号码
			//未完成
			
			
			
			
		}
		function insert(){
			var customerName=$("#customerName").val()
			var sqDocumentTime=$("#sqDocumentTime").val()
			var sqDeliveryAddress=$("#sqDeliveryAddress").val()
			var sqId=$("#sqId").val()
			var sqEffectiveTime=$("#sqEffectiveTime").val()
			var currencyName=$("#currencyName").val()
			var sqTax=$("#sqTax").val()
			var sqExchangeRate=$("#sqExchangeRate").val()
			var staffName=$("#staffName").val()
			var sqAuditing=$("#sqAuditing").val()
			var departName=$("#departName").val()
			var sqYn=$("#sqYn").val()
			
			var list=[]
			$("table tbody tr").each(function(i,obj){
				var a={}
				$("table tbody tr input").each(function(i2,obj2){
					var attr=$(obj2).attr("id")
					a[attr]=$(obj2).val()
				})
				list.push(a)
			})
			var data={
              		customerName:customerName,
              		sqDocumentTime:sqDocumentTime,
              		sqDeliveryAddress:sqDeliveryAddress,
              		sqId:sqId,
              		sqEffectiveTime:sqEffectiveTime,
              		currencyName:currencyName,
              		sqTax:sqTax,
              		sqExchangeRate:sqExchangeRate,
              		staffName:staffName,
              		sqAuditing:sqAuditing,
              		departName:departName,
              		sqYn:sqYn,
              		list:list
          		}
			console.log(data)
			$.ajax({
				type:"post",
          		url:"http://localhost:8080/SoftwareFactoryProject_/zp/addbaojia",
          		contentType:"application/json",
				data:JSON.stringify(data),
         		success:function(r){
         			if(r>0){
         				alert("新增成功！")
         			}
         		}
          	})
		}
		function toupdate(){
			f=2
			$("[readonly='readonly']").each(function(i,obj){
				$(obj).removeAttr("readonly")
			})
			$("#sqId").attr("readonly","readonly")
			$("#sqTax").removeAttr("disabled")
			$("[name=readonly]").attr("readonly","readonly")
			flag=true
		}
		function update(){
			var customerName=$("#customerName").val()
			var sqDocumentTime=$("#sqDocumentTime").val()
			var sqDeliveryAddress=$("#sqDeliveryAddress").val()
			var sqId=$("#sqId").val()
			var sqEffectiveTime=$("#sqEffectiveTime").val()
			var currencyName=$("#currencyName").val()
			var sqTax=$("#sqTax").val()
			var sqExchangeRate=$("#sqExchangeRate").val()
			var staffName=$("#staffName").val()
			var sqAuditing=$("#sqAuditing").val()
			var departName=$("#departName").val()
			var sqYn=$("#sqYn").val()
			
			var list=[]
			$("table tbody tr").each(function(i,obj){
				var a={}
				$("table tbody tr input").each(function(i2,obj2){
					var attr=$(obj2).attr("id")
					a[attr]=$(obj2).val()
				})
				list.push(a)
			})
			var data={
              		customerName:customerName,
              		sqDocumentTime:sqDocumentTime,
              		sqDeliveryAddress:sqDeliveryAddress,
              		sqId:sqId,
              		sqEffectiveTime:sqEffectiveTime,
              		currencyName:currencyName,
              		sqTax:sqTax,
              		sqExchangeRate:sqExchangeRate,
              		staffName:staffName,
              		sqAuditing:sqAuditing,
              		departName:departName,
              		sqYn:sqYn,
              		list:list
          		}
			console.log(data)
			$.ajax({
				type:"post",
          		url:"http://localhost:8080/SoftwareFactoryProject_/zp/updatebaojia",
          		contentType:"application/json",
				data:JSON.stringify(data),
         		success:function(r){
         			if(r>0){
         				alert("修改成功！")
         			}
         		}
          	})
		}
		function baoc(){
			if(f>1){
				//修改
				update()
			}else{
				//新增
				insert()
			}
		}
		function todelete(){
			var flag=confirm("是否确认删除？")
			if(flag){
				alert($("#sqId").val())
				$.ajax({
				type:"post",
          		url:"http://localhost:8080/SoftwareFactoryProject_/zp/deletebaojia",
				data:{sqId:$("#sqId").val()},
         		success:function(r){
         			if(r>0){
         				alert("删除成功！")
         				jz(1,1)
         			}
         		}
          	})
			}
		}
		function a(){
			if(flag){
				$("tbody").append(`
					<tr>
					<td><input id='sqdProdid'></td>
					<td><input id='sqdSerno'></td>
					<td><input id='sqdProdname'></td>
					<td><input id='sqdProdsize'></td>
					<td><input id='sqdUnitname'></td>
					<td><input id='sqdSquantity'></td>
					<td><input id='sqdZkqprice'></td>
					<td><input id='sqdDiscount'></td>
					<td><input id='sqdUnitprice'></td>
					<td><input id='sqdPrice'></td>
					<td><input id='sqdTaxrate'></td>
					<td><input id='sqdTaxlimit'></td>
					<td><input id='sqdTaxinclusiveprice'></td>
					<td><input id='sqdComplimentart'></td>
					<td><input id='sqdItemremark'></td>
					</tr>
				`)
			}
		}
    </script>
	</body>

</html>