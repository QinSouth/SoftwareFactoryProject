<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>预收冲款单</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../css/font.css">
		<link rel="stylesheet" href="../../css/xadmin.css">
		<script src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/xadmin.js"></script>

		<style type="text/css">
			.layui-input-block {
				margin-left: 120px;
				min-height: 36px;
			}
			
			.layui-row {
				margin-bottom: 10px;
			}
			
			.layui-form-label {
				float: left;
				display: block;
				padding: 9px 5px;
				width: 85px;
				font-weight: 400;
				line-height: 20px;
				text-align: right;
			}
			
			.layui-form-item {
				margin-top: 5px;
				margin-bottom: 5px;
				clear: none;
				display: inline-block;
			}
			
			.layui-tab-title li {
				padding: 0 0px;
			}
			
			.layui-table {
				width: 100%;
				background-color: #fff;
				color: #666;
				overflow-y: auto;
			}
			
			.layui-table thead tr {
				background-color: #d7e7ff !important;
			}
			
			.layui-table td,
			.layui-table th {
				border-width: 1px;
				border-style: solid;
				border-color: #d3d1d1;
			}
			
			.color {
				color: blue;
			}
		</style>
	</head>

	<body>
		<div id="vue_fw" class="x-body">
			<div class="layui-container" style="padding: 8px;">
				<div class="layui-row">
					<div class="layui-col-md12">
						<span style="font-size: 18px;padding-left: 15px;">
			   			预收款单
			   		</span>
			   		<span v-if="advances_received_main_y.priabillAuditstatus > 0" style="color: red;margin-left: 100px;">已审核</span>
					</div>
				</div>
				<div style="padding: 10px;">
					<div class="layui-row">
						<form class="layui-form" action="">
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label color">客户</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillCustomerName" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label color">单据日期</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillPayablestime" id="date1" name="title" required lay-verify="date" placeholder="" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">结算方式一</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillPrice1" name="title" required lay-verify="required" placeholder="转账" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label color">单据号码</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillId" id="priabillId"  name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">结算方式二</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillPrice2" name="title" required lay-verify="required" placeholder="汇票" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label color">币别</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillCurrencyName" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">结算方式三</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillPrice3" name="title" required lay-verify="required" placeholder="现金" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">汇率</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.payablesExchangeRate" name="title" required lay-verify="required" placeholder="1.0000" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">折扣率（%）</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillZhekou" name="title" required lay-verify="required" placeholder="0.00" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">应收冲款类型</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillType" readonly="readonly" name="title" required lay-verify="required" placeholder="预收冲款" autocomplete="off" class="layui-input" disabled="disabled">
									<!-- 
									<select name="city" lay-verify="required">
										<option value=""></option>
										<option value="0">预收款</option>
										<option value="1">收款冲款</option>
										<option value="2">预收冲应收</option>
									</select>
									-->
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">终止账月</label>
								<div class="layui-input-block">
									<input type="date" v-model="advances_received_main_y.priabillEndtime" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">凭证编号</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillVoucherno" readonly="readonly" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
						</form>
					</div>
					<div class="layui-row">
						<div class="layui-tab">
							<ul class="layui-tab-title">
								<li class="layui-this">内容</li>
								<li>备注</li>
							</ul>
							<div class="layui-tab-content">
								<div class="layui-tab-item layui-show">
									<div style="border:1px solid #8eafdb;padding:8px;">
										<div style="overflow: scroll;">
											<table class="layui-table" lay-size="sm" style="width: 150%;">
												<thead>
													<tr>
														<td>预收金额</td>
														<td>来源单别</td>
														<td>来源单号</td>
														<td>摘要</td>
													</tr>
												</thead>
												<tbody>
													<tr v-for="a in advances_received_main_y.ardy">
														<td>{{a.priabillPrice}}</td>
														<td>{{a.priabillType}}</td>
														<td>{{a.priabillNumber}}</td>
														<td>{{a.priabillRemarks}}</td>
													</tr>
												</tbody>
												<tfoot>
													<tr>
														<td colspan="">合计:</td>
														<td colspan="3">{{heji}}</td>
													</tr>
												</tfoot>
											</table>
										</div>
									</div>
								</div>
								<div class="layui-tab-item">
									<form class="layui-form" action="">
										<div class="layui-form-item layui-col-md6">
											<label class="layui-form-label">自定栏一</label>
											<div class="layui-input-block">
												<input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
											</div>
										</div>
										<div class="layui-form-item layui-col-md6">
											<label class="layui-form-label">自定栏二</label>
											<div class="layui-input-block">
												<input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
											</div>
										</div>
										<div class="layui-form-item layui-col-md12">
											<label class="layui-form-label">备注</label>
											<div class="layui-input-block">
												<textarea v-model="advances_received_main_y.priabillRemarks" rows="12" name="desc" placeholder="请输入内容" class="layui-textarea" disabled="disabled"></textarea>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-row">
						<form class="layui-form" action="">

							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">制单人员</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillBillpersonnel" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label color">所属部门</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillTeamName" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">复核人员</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillReviewers" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
							<div class="layui-form-item layui-col-md6">
								<label class="layui-form-label">所属项目</label>
								<div class="layui-input-block">
									<input type="text" v-model="advances_received_main_y.priabillProjectName" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input" disabled="disabled">
								</div>
							</div>
						</form>
					</div>
					<div class="layui-row">
						<button class="layui-btn layui-btn-normal" style="width: 8%;">查询</button>
						<button class="layui-btn layui-btn-normal" style="width: 8%;">转单</button>
						<button class="layui-btn layui-btn-normal" style="width: 8%;">功能</button>
					</div>
				</div>
			</div>
		</div>

		<script src="../../js/jquery.min.js"></script>
		<script src="../../layui.all.js"></script>
		<script src="../../layui.js"></script>
		<script src="../../js/vue.js"></script>

		<script type="text/javascript">
			var state = "";
			
			function subpageTriggerEvent(incident){
				//alert("部门设定页 - 触发事件：" + incident);
				
				if(incident == "goFirstPage"){
					vue.goFirstPage();
				} else if(incident == "goPrePage"){
					vue.goPrePage();
				} else if(incident == "goNextPage"){
					vue.goNextPage();
				} else if(incident == "goLastPage"){
					vue.goLastPage();
				} else if(incident == "goInsert"){
					vue.goInsert();
				} else if(incident == "save"){
					vue.save();
				} else if(incident == "cancel"){
					vue.cancel();
				} else if(incident == "goUpdate"){
					vue.goUpdate();
				} else if(incident == "delete"){
					vue.delete_();
				} else if(incident == "refresh") {
					vue.refresh();
				}  else if(incident == "audit"){
					vue.yesaudit();
				}  else if(incident == "cancelTheAudit"){
					vue.noaudit();
				}

state = incident;
}

var vue = new Vue({
			el: "#vue_fw",
			/*data: {
				pageCd: {},
				advances_received_main_y: {
					priabillId: 2020020201,
					priabillPayablestime: '2020-02-02',
					pageNum: 1
				},
				state: ""
			},*/
			data() {
				return{
					pageCd: {},
					advances_received_main_y: {
						priabillId: 2020020201,
						priabillPayablestime: '2020-02-02',
						pageNum: 1
					},
					heji: 0,
					state: ""
				}
			},
			methods: {
				//时间格式化函数，此处仅针对yyyy-MM-dd hh:mm:ss 的格式进行格式化
				dateFormat: function(time) {
					var date = new Date(time);
					var year = date.getFullYear();
					/* 在日期格式中，月份是从0开始的，因此要加0
					 * 使用三元表达式在小于10的前面加0，以达到格式统一  如 09:11:05
					 * */
					var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
					var day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
					var hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
					var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
					var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
					// 拼接
					return year + "-" + month + "-" + day;
					//return year + "-" + month + "-" + day + " " + hours + ":" + minutes + ":" + seconds;
				},
				gt_select_payablestime: function(payablestime) {
						var vue_ = this;

						$.ajax({
							type:"get",
							async : false,
							url : "http://localhost:8080/SoftwareFactoryProject_/gt_AdvancesReceivedMainY/gt_select_payablestime?payablestime=" + payablestime,
            				dataType : "json",
							success : function(result) {
								//alert(result);
			                    vue_.advances_received_main_y.priabillId = result;
							}
						});
					},
					queryPage : function(pageNum_){
						$(".layui-form-item>div>input,.layui-form-item>div>textarea").prop("disabled", true);
						
						var this_ = this;
						this_.heji = 0;
						this.advances_received_main_y.pageNum = pageNum_;
						
						$.ajax({
							type : "post",
							async : false,
							url : "http://localhost:8080/SoftwareFactoryProject_/gt_AdvancesReceivedMainY/gt_queryPage_AdvancesReceivedMainY",
							data : JSON.stringify(this.advances_received_main_y),
							contentType : 'application/json;charset=UTF-8',
            				dataType : "json",
							success : function(result) {
								//	alert(JSON.stringify(result));
								this_.pageCd = result;
								this_.advances_received_main_y = this_.pageCd.list[0];
								//时间格式默认为UTC地区时间格式，调用手写的时间格式转换方式转换成yyyy-MM-dd hh:mm:ss/**/
								this_.advances_received_main_y.priabillPayablestime = this_.dateFormat(this_.advances_received_main_y.priabillPayablestime);
								for (i = 0; i < this_.advances_received_main_y.ardy.length; i++) {
									this_.heji = this_.heji + parseInt(this_.advances_received_main_y.ardy[i].priabillPrice);
								}
							}
						});
					},
		   			goFirstPage : function(){
		   				this.queryPage(1);
		   			},
		   			goPrePage : function(){
		   				if(this.pageCd.hasPreviousPage)
		      				this.queryPage(this.pageCd.prePage);
		   			},
		   			goNextPage : function(){
		   				if(this.pageCd.hasNextPage)
		      				this.queryPage(this.pageCd.nextPage);
		   			},
		   			goLastPage : function(){
		   				this.queryPage(this.pageCd.pages);
		   			},
					goInsert : function(){
						$(".layui-form-item>div>input,.layui-form-item>div>textarea").prop("disabled", false);
						this.state = "goInsert";
						this.department = {};
						
						Object.assign(this.$data, this.$options.data())
						
						var now = new Date();
						//格式化日，如果小于9，前面补0  
						var day = ("0" + now.getDate()).slice(-2);
						//格式化月，如果小于9，前面补0  
						var month = ("0" + (now.getMonth() + 1)).slice(-2);
						//拼装完整日 期格式  
						var today = now.getFullYear() + "-" + (month) + "-" + (day);
						//将获取的当前日期赋值给主表的单据日期
						this.advances_received_main_y.priabillPayablestime = today;
						//调用根据单据日期查询赋值单据号码方法（传参单据日期）
						this.gt_select_payablestime(this.advances_received_main_y.priabillPayablestime);
						
						
					},
					save : function(){
						//alert("执行" + this.state + "操作！");
						var this_ = this;
						
						
						
					},
					cancel : function(){
						if(this.state == "goInsert"){
			   				if(confirm("确定取消本次新增操作吗！？"))
								this.queryPage(1);
						} else if(this.state == "goUpdate"){
			   				if(confirm("确定取消本次修改操作吗！？"))
		   						this.queryPage(this.pageCd.pages);
						}
					},
					goUpdate : function(){
						$(".layui-form-item>div>input,.layui-form-item>div>textarea").prop("disabled", false);
						this.state = "goUpdate";
					},
					delete_ : function(){
		   				if(!confirm("确认删除记录项吗？"))
		   					return false;
		   				
						var this_ = this;
						var status = false;
						var priabillId = this_.advances_received_main_y.priabillId;
						if(this_.advances_received_main_y.priabillAuditstatus > 0){
							alert("目前数据已审核，无法执行此操作");
						}
						else{
							$.ajax({
								type:"get",
								url : "http://localhost:8080/SoftwareFactoryProject_/gt_AdvancesReceivedMainY/gt_del_mydy?priabillId=" + priabillId,
            					//async:true,
								success : function(result) {
									if(result > 0){
										this_.queryPage(1);
									}
								}
							});
						}
						
					},
					refresh : function(){
						this.queryPage(1);
					},
					yesaudit : function(){
						//审核
						var this_ = this;
						var priabillId = this_.advances_received_main_y.priabillId;

						//var status = false;
						if(this_.advances_received_main_y.priabillAuditstatus == 0){
							$.ajax({
								type:"get",
								url : "http://localhost:8080/SoftwareFactoryProject_/gt_AdvancesReceivedMainY/gt_update_Auditstatus?priabillId=" + priabillId,
            					//async:true,
            					success : function(result) {
									if(result > 0){
										this_.advances_received_main_y.priabillAuditstatus = 1;
									}
								}
							});
						}
					},
					noaudit : function(){
						//反审核
						alert("0")
					}
				},
				created: function() {
					this.queryPage(1);
					
					/*							
					var now = new Date();
					//格式化日，如果小于9，前面补0  
					var day = ("0" + now.getDate()).slice(-2);
					//格式化月，如果小于9，前面补0  
					var month = ("0" + (now.getMonth() + 1)).slice(-2);
					//拼装完整日 期格式  
					var today = now.getFullYear() + "-" + (month) + "-" + (day);
					//将获取的当前日期赋值给主表的单据日期
					this.advances_received_main_y.priabillPayablestime = today;
					//调用根据单据日期查询赋值单据号码方法（传参单据日期）
					this.gt_select_payablestime(this.advances_received_main_y.priabillPayablestime);		//		*/
				},
				mounted : function(){
					var vue_ = this;
					
					layui.use('laydate', function(){
						var laydate = layui.laydate;
						
						//执行一个laydate实例
						laydate.render({
							elem : '#date1',	//指向元素
							done : function(value){
								//alert(value);
								vue_.advances_received_main_y.priabillPayablestime = value;
								console.log("分别输出两个值：" + value + " - " + vue_.advances_received_main_y.priabillPayablestime);
								
								vue_.gt_select_payablestime(vue_.advances_received_main_y.priabillPayablestime);
								//$("#priabill_id").val(result);		这条代码有效，当时逼急了，拿这条代码出来看看效果可怜自己
							}
						});
					});
				}
			})
		</script>
	</body>

</html>