<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>销售退货单</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../css/font.css">
		<link rel="stylesheet" href="../../css/xadmin.css">
		<script src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/xadmin.js"></script>
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	</head>
	<link rel="stylesheet" href="../../css/layui.css" />
	<script type="text/javascript" src="../../js/jquery-1.12.4.js"></script>
	<!--<script type="text/javascript" src="../../js/layui.js" ></script>-->
	<script type="text/javascript" src="../../layui.all.js"></script>
	<style>
		.xscz {
			margin-left: 35px;
			width: 150px;
		}
	</style>
	<script type="text/javascript">
		window.onload = function() {
			//去掉默认的contextmenu事件，否则会和右键事件同时出现。
			document.oncontextmenu = function(e) {
				e.preventDefault();
			};
			document.getElementById("xsth").onmousedown = function(e) {
				if(e.button == 2) {
					layui.use('layer', function() {
						var layer = layui.layer;
						layer.open({
							title: '请选择操作',
							type: 0,
							content: '<select class=xscz onblur=xsxzcz(this)><option value=1>新增</option><option value=2>修改</option><option value=3>删除</option><option value=4>审核</option></select>'

						});
					});
				}
			}
		}

		function xsxzcz(obj) {
			//alert($(obj).val());
			if($(obj).val() == 1) {
				$("input").prop("readonly", false);
				$("select").prop("disabled", false);
				$("textarea").prop("readonly", false);
			}
			layer.closeAll();
		}
	</script>

	<body >
		<div id="main-div">
		<div class="x-body">
			<h2>销售退货单</h2>
		</div>
		<div class="layui-container">
			<div id="xsth">
				<div class="layui-col-md10 layui-col-md-offset2"></div>
				<div class="layui-row">
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">客户</span>
						<input type="text" class="layui-col-md-offset1 layui-input" style="width: 170px;" disabled="disabled" v-model="salesorder.customerId"/>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">单据日期</span> <input type="date" style="width: 170px;" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwtId"/>
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">送货地址</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwPriceIncludeTax"/>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">单据号码</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwCertificateNumber"/>
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">单价是否含税</span>
						<select name="" style="width: 170px;" lay-verify="required" class=" layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.salescxrk">
							<option value=""></option>
						</select>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">币别</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.warehouseId"/>
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">仓库</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwCertificateNumber"/>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">汇率</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwDocumentDate"/>
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">重新出库</span>
						<select name="" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwDocumentNumber">
							<option value=""></option>
						</select>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">国外贸易</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.currencyId"/>
					</div><br /><br /><br />
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">凭证编码</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwExchangeRate"/>
					</div>
					<div class="layui-tab layui-col-md10 layui-col-md-offset2">
						<ul class="layui-tab-title layui-col-md10 layui-col-md-offset2">
							<li class="layui-this">内容</li>
							<li>备注</li>

						</ul>
						<div class="layui-tab-content layui-col-md10 layui-col-md-offset2">
							<div class="layui-tab-item layui-show layui-tab-content " style=" overflow-x: scroll; overflow-y: scroll;">
								<table class="layui-table" readonly="readonly" height="500">

									<thead>
										<tr>
											<th style="white-space: nowrap;">(栏号)</th>
											<th style="white-space: nowrap;">物料编号</th>
											<th style="white-space: nowrap;">(物料名称)</th>
											<th style="white-space: nowrap;">(规格型号)</th>
											<th style="white-space: nowrap;">(单位名称)</th>
											<th style="white-space: nowrap;">数量</th>
											<th style="white-space: nowrap;">折扣钱单价</th>
											<th style="white-space: nowrap;">折数(%)</th>
											<th style="white-space: nowrap;">单价</th>
											<th style="white-space: nowrap;">金额</th>
											<th style="white-space: nowrap;">税额(%)</th>
											<th style="white-space: nowrap;">(含税金额)</th>
											<th style="white-space: nowrap;">(批号)</th>
											<th style="white-space: nowrap;">赠品</th>
											<th style="white-space: nowrap;">(发票明细)</th>
											<th style="white-space: nowrap;">(未开票金额)</th>
											<th style="white-space: nowrap;">分录备注</th>
											<th style="white-space: nowrap;">(来源单别)</th>
											<th style="white-space: nowrap;">(来源单号)</th>
										</tr>
									</thead>
									<tbody>
											<tr v-for="sa,index in salesorder.srwList">
											<td>{{sa.srwdId}}</td>
											<td>{{sa.matterId}}</td>
											<td>{{sa.srwdEngname}}</td>
											<td>{{sa.srwdRemark}}</td>
											<td>{{sa.srwdPriceIncludeTax}}</td>
											<td>{{sa.srwdSingleStatus}}</td>
											<td>{{sa.srwdDocumentDate}}</td>
											<td>{{sa.srwdDocumentNumber}}</td>
											<td>{{sa.srwdPrice}}</td>
											<td>{{sa.srwdMoney}}</td>
											<td>{{sa.srwdTaxRate}}</td>
											<td>{{sa.srwdTaxAmount}}</td>
											<td>{{sa.srwdIncludingTaxAmount}}</td>
											<td>{{sa.srwdBatchNumber}}</td>
											<td>{{sa.srwdIfgift}}</td>
											<td>{{sa.srwdInvoiceDetails}}</td>
											<td>{{sa.srwdNomakeInvoiceNum}}</td>
											<td>{{sa.srwdRemarks}}</td>
											<td>{{sa.srwdSourceOrder}}</td>
										</tr>
									</tbody>
								</table>
							</div>

							<div class="layui-tab-item layui-col-md12">
								<div class="layui-col-md12">
									<span class="layui-col-md2" style="margin-left: 25px;">备注</span><textarea style="margin-left: 27px;" disabled="disabled" rows="6" cols="81" v-model="salesorder.soSubordinate"></textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">业务人员</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwHeaderProvision"/>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">制单人员</span><input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwEndClause"/>
					</div><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">所属部门</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwRemark"/>
					</div>
					<div class="layui-col-md5">
						<span class="layui-col-md2" style="margin-top: 15px;">复核人员</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwAuditing"/>
					</div><br/><br/>
					<div class="layui-col-md5 layui-col-md-offset2">
						<span class="layui-col-md3" style="margin-top: 15px;">所属项目</span> <input type="text" style="width: 170px;" class="layui-col-md-offset1 layui-input" disabled="disabled" v-model="salesorder.srwYn"/>
					</div>

					<div class="layui-col-md12">
						<button style="width: 150;background: #1E9FFF;" class="layui-col-md2 layui-col-md-offset2 layui-btn" disabled="disabled">转单</button>
						<button style="width: 150;background: #1E9FFF;" class="layui-col-md2 layui-col-md-offset1 layui-btn" disabled="disabled">查询</button>
						<button style="width: 150;background: #1E9FFF;" class="layui-col-md2 layui-col-md-offset1 layui-btn" disabled="disabled">功能</button>
					</div>
				</div>
			</div>
		</div>
		<!--<script>
    	function oninit(){
    		layui.use('layer',function(){
    			var layer= layui.layer;
    		 layer.open({
    		 	title:'销售退货单',
			  type: 2, 
			  maxmin:true,
			  area:['995px','520px'],
//			  maxWidth:60,
//			  maxHeight:1000,
			  content: '销售退货.html' //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
			}); 
    		})
    		
    	}
       
    </script>-->
    </div>
    <script src="../../js/jquery.min.js"></script>
		<script type="text/javascript" src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/xadmin.js"></script>
		<script type="text/javascript" src="../../js/vue.js"></script>
		<script type="text/javascript" src="../../js/axios.min.js"></script>
		<script>
			//必须设置允许跨域访问session中数据(cooike)
			axios.default.withCredentials = true;
			
			var state = "";
			
			function subpageTriggerEvent(incident){
				//alert("部门设定页 - 触发事件：" + incident);
				
				if(incident == "goFirstPage"){
					listVm.goFirstPage();
				} else if(incident == "goPrePage"){
					listVm.goPrePage();
				} else if(incident == "goNextPage"){
					listVm.goNextPage();
				} else if(incident == "goLastPage"){
					listVm.goLastPage();
				} else if(incident == "goInsert"){
					listVm.goInsert();
				} else if(incident == "save"){
					listVm.save();
				} else if(incident == "cancel"){
					listVm.cancel();
				} else if(incident == "goUpdate"){
					listVm.goUpdate();
				} else if(incident == "delete"){
					listVm.delete_();
				} else if(incident == "refresh"){
					listVm.refresh();
				}
				
				state = incident;
			}
			
			//创建Vue对象
			var listVm=new Vue({
				el:"#main-div",
				data:{
					pagelist:{},
					salesorder:{
						pageNum : 1
					},
					salelist:[],
					state:""
				},
				methods:{
					queryPage: function(pageNum_){
						$("input").prop("disabled", true);
						$("select").prop("disabled", true);
						$("textarea").prop("disabled", true);
						var this_ = this;
						this.salesorder.pageNum = pageNum_;
					
						axios.post(`http://localhost:8080/SoftwareFactoryProject_/salereturnwarehouse/PageQueryAll`, this.salesorder).then(function(res){
							//数据正常
							alert(JSON.stringify(res.data));
							this_.pagelist = res.data;
							this_.salesorder = this_.pagelist.list[0];
						});
					},
					goFirstPage : function(){
		   				this.queryPage(1);
		   			},
		   			goPrePage : function(){
		   				if(this.pagelist.hasPreviousPage)
		      				this.queryPage(this.pagelist.prePage);
		   			},
		   			goNextPage : function(){
		   				if(this.pagelist.hasNextPage)
		      				this.queryPage(this.pagelist.nextPage);
		   			},
		   			goLastPage : function(){
		   				this.queryPage(this.pagelist.pages);
		   			},
		   			goInsert : function(){
						$("input").prop("disabled", false);
						$("select").prop("disabled", false);
						$("textarea").prop("disabled", false);
						this.state = "goInsert";
						this.salesorder = {};
						alert(JSON.stringify(salesorder));
					},
					save : function(){
						//alert("执行" + this.state + "操作！");
						var this_ = this;
						this.salesorder.flag = this.state;
						
						axios.put(`http://localhost:8080/SoftwareFactoryProject_/salereturnwarehouse/insertOrUpdateCD`, this.salesorder).then(function(res){
							//数据正常		/alert(JSON.stringify(res));
							if(res.data.code == "1"){
		   						this_.queryPage((this_.pagelist.pages+1));
								return false;
							} else if(res.data.code == "2"){
								$("input").prop("disabled", true);
								$("select").prop("disabled", true);
								$("textarea").prop("disabled", true);
								return false;
							}
							alert("非常遗憾，本次" + res.data.message);
						});
					},
					cancel : function(){
						if(this.state == "goInsert"){
			   				if(confirm("确定取消本次新增操作吗！？"))
								this.queryPage(1);
						} else if(this.state == "goUpdate"){
			   				if(confirm("确定取消本次修改操作吗！？"))
		   						this.queryPage(this.pagelist.pages);
						}
						
					},
					goUpdate : function(){
								$("input").prop("disabled", false);
								$("select").prop("disabled", false);
								$("textarea").prop("disabled", false);
						this.state = "goUpdate";
					},
					delete_ : function(){
		   				if(!confirm("确定删除本条仓库数据吗？"))
		   					return false;
		   				
						var this_ = this;
		   				//数据无误			/	alert("参数：" + this.department.departid);
		   				axios.delete(`http://localhost:8080/SoftwareFactoryProject_/salereturnwarehouse/deleteById/` + this.salesorder.srwId).then(function(res){
							//数据正常		/alert(JSON.stringify(res));
							if(res.data.code == "1"){
								this_.queryPage(1);
								return false;
							}
							alert("非常遗憾，本次" + res.data.message);
						});
					},
					refresh : function(){
						this.queryPage(1);
					}
				},
				mounted : function(){
					this.queryPage(1);
					
					
				}
			});
		</script>
	</body>

</html>